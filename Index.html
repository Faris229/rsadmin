<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADMIN | PINK SYSTEM</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@200;400;600;800&family=Prompt:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Prompt', 'sans-serif'], display: ['Kanit', 'sans-serif'] },
                    colors: { pink: { glow: '#ec4899', deep: '#be185d', dark: '#831843' } },
                    animation: { 'pulse-glow': 'pulseGlow 2s infinite' },
                    keyframes: { pulseGlow: { '0%, 100%': { boxShadow: '0 0 5px #ec4899' }, '50%': { boxShadow: '0 0 20px #ec4899' } } }
                }
            }
        }
    </script>

    <style>
        body { background-color: #050b14; color: #fff; overflow-x: hidden; }
        .bg-cyber { position: fixed; inset: 0; z-index: -2; background: radial-gradient(circle at 50% -20%, #4c1d95 0%, #050b14 70%); }
        .glass-card { background: linear-gradient(145deg, rgba(26, 11, 46, 0.8), rgba(15, 5, 24, 0.95)); backdrop-filter: blur(16px); border: 1px solid rgba(236, 72, 153, 0.2); border-radius: 20px; box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1); }
        .glass-nav { background: rgba(15, 5, 24, 0.95); border-right: 1px solid rgba(236, 72, 153, 0.1); }
        .input-adm { width: 100%; background: rgba(0, 0, 0, 0.3); border: 1px solid #be185d; padding: 12px; border-radius: 10px; color: white; outline: none; transition: 0.3s; }
        .input-adm:focus { border-color: #ec4899; box-shadow: 0 0 10px rgba(236, 72, 153, 0.3); }
        .btn-pink { background: linear-gradient(135deg, #ec4899, #d946ef); color: white; font-weight: 800; border-radius: 12px; box-shadow: 0 4px 15px rgba(236, 72, 153, 0.4); transition: 0.3s; }
        .btn-pink:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(236, 72, 153, 0.6); }
        .menu-item { display: flex; items-center; gap: 12px; padding: 16px; border-radius: 12px; color: #9ca3af; transition: 0.3s; cursor: pointer; }
        .menu-item:hover, .menu-item.active { background: rgba(236, 72, 153, 0.1); color: #ec4899; border-right: 4px solid #ec4899; }
        
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 100; display: none; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .modal-box { background: #1a0b2e; width: 90%; max-width: 550px; padding: 30px; border-radius: 24px; border: 1px solid rgba(236, 72, 153, 0.3); animation: zoomIn 0.3s; position: relative; }
        
        /* Table & Badges */
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; padding: 16px; color: #ec4899; font-size: 0.8rem; text-transform: uppercase; border-bottom: 1px solid rgba(255,255,255,0.05); }
        td { padding: 16px; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 0.9rem; }
        tr:hover { background: rgba(236, 72, 153, 0.05); }
        .lock-badge { background: #ef4444; color: white; font-size: 0.6rem; padding: 2px 6px; border-radius: 4px; display: inline-flex; align-items: center; gap: 4px; }
    </style>
</head>
<body class="flex h-screen text-sm md:text-base">

    <div class="bg-cyber"></div>

    <div id="view-login" class="fixed inset-0 z-[200] bg-[#050b14] flex items-center justify-center p-6">
        <div class="w-full max-w-sm glass-card p-10 text-center">
            <h1 class="text-5xl font-black font-display text-transparent bg-clip-text bg-gradient-to-r from-pink-500 to-purple-500 mb-2">ZONE.</h1>
            <p class="text-pink-300 text-xs font-bold tracking-[0.3em] uppercase mb-8">ADMINISTRATOR</p>
            <div class="space-y-4">
                <input id="a-email" value="faris@gmail.com" class="input-adm text-center" placeholder="Email">
                <input id="a-pass" type="password" class="input-adm text-center" placeholder="Password">
                <button onclick="Admin.login()" class="btn-pink w-full py-3 text-lg">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
            </div>
        </div>
    </div>

    <aside id="sidebar" class="w-64 glass-nav hidden flex-col p-6 z-50 h-full">
        <div class="flex items-center gap-3 mb-10 px-2">
            <div class="w-10 h-10 bg-gradient-to-br from-pink-500 to-purple-600 rounded-lg flex items-center justify-center text-xl font-bold shadow-lg shadow-pink-500/30">A</div>
            <div><div class="font-bold text-lg leading-none">ZONE.</div><div class="text-[10px] text-green-400 font-bold">‚óè SYSTEM ONLINE</div></div>
        </div>
        
        <nav class="flex-1 space-y-1">
            <div onclick="UI.tab('dash')" id="tab-dash" class="menu-item active"><i class="fa-solid fa-chart-line w-6"></i> ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</div>
            <div onclick="UI.tab('trans')" id="tab-trans" class="menu-item"><i class="fa-solid fa-money-bill-transfer w-6"></i> ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏ù‡∏≤‡∏Å/‡∏ñ‡∏≠‡∏ô <span id="noti-badge" class="ml-auto bg-red-500 text-white text-[10px] px-2 rounded-full hidden">!</span></div>
            <div onclick="UI.tab('users')" id="tab-users" class="menu-item"><i class="fa-solid fa-users w-6"></i> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</div>
            <div onclick="UI.tab('rooms')" id="tab-rooms" class="menu-item"><i class="fa-solid fa-gamepad w-6"></i> ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡∏°</div>
            <div onclick="UI.tab('settings')" id="tab-settings" class="menu-item"><i class="fa-solid fa-gears w-6"></i> ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå</div>
        </nav>
        <button onclick="auth.signOut()" class="bg-red-500/10 text-red-400 py-3 rounded-xl font-bold hover:bg-red-500/20 transition mt-4"><i class="fa-solid fa-power-off mr-2"></i> ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
    </aside>

    <main id="main-content" class="flex-1 p-8 overflow-y-auto hidden">
        
        <div id="page-dash" class="animate__animated animate__fadeIn">
            <header class="flex justify-between items-center mb-8">
                <div><h1 class="text-3xl font-bold font-display">‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö</h1><p class="text-slate-400">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</p></div>
                <button onclick="Admin.fixData()" class="bg-yellow-500/20 text-yellow-400 border border-yellow-500/50 px-4 py-2 rounded-lg text-sm hover:bg-yellow-500 hover:text-black transition"><i class="fa-solid fa-wrench mr-2"></i> ‡∏ã‡πà‡∏≠‡∏°‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏ß‡πá‡∏ö‡πÇ‡∏•‡πà‡∏á)</button>
            </header>

            <div class="grid grid-cols-4 gap-6 mb-8">
                <div class="glass-card p-6 border-b-4 border-blue-500"><div class="text-slate-400 text-xs uppercase font-bold">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div><div id="stat-users" class="text-4xl font-bold mt-2">0</div></div>
                <div class="glass-card p-6 border-b-4 border-yellow-500"><div class="text-slate-400 text-xs uppercase font-bold">‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</div><div id="stat-pending" class="text-4xl font-bold mt-2 text-yellow-400">0</div></div>
                <div class="glass-card p-6 border-b-4 border-green-500"><div class="text-slate-400 text-xs uppercase font-bold">‡∏¢‡∏≠‡∏î‡∏ù‡∏≤‡∏Å‡∏£‡∏ß‡∏°</div><div id="stat-dep" class="text-3xl font-mono font-bold mt-2 text-green-400">0</div></div>
                <div class="glass-card p-6 border-b-4 border-red-500"><div class="text-slate-400 text-xs uppercase font-bold">‡∏¢‡∏≠‡∏î‡∏ñ‡∏≠‡∏ô‡∏£‡∏ß‡∏°</div><div id="stat-wit" class="text-3xl font-mono font-bold mt-2 text-red-400">0</div></div>
            </div>

            <div class="glass-card overflow-hidden">
                <div class="p-5 border-b border-white/5 font-bold bg-white/5">‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (Real-time)</div>
                <table class="w-full text-left">
                    <thead><tr><th>User</th><th>Type</th><th>Amount</th><th class="text-right">Time</th></tr></thead>
                    <tbody id="live-trans"><tr><td colspan="4" class="text-center p-8 text-slate-500">‡∏£‡∏≠‡πÇ‡∏´‡∏•‡∏î...</td></tr></tbody>
                </table>
            </div>
        </div>

        <div id="page-trans" class="hidden animate__animated animate__fadeIn">
            <h1 class="text-3xl font-bold mb-8 font-display">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (Approval)</h1>
            <div class="grid grid-cols-3 gap-8">
                <div class="col-span-2 glass-card overflow-hidden h-[600px] flex flex-col">
                    <div class="p-5 border-b border-white/5 bg-yellow-500/10 flex justify-between items-center"><div class="font-bold text-yellow-400">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</div><span class="text-xs text-slate-400">‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏±‡∏î/‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</span></div>
                    <div class="overflow-y-auto flex-1">
                        <table class="w-full text-left">
                            <thead class="bg-white/5"><tr><th>User</th><th>Type</th><th>Amount</th><th>Info</th><th class="text-center">Action</th></tr></thead>
                            <tbody id="request-list"></tbody>
                        </table>
                        <div id="empty-req" class="hidden flex flex-col items-center justify-center h-full text-slate-500"><i class="fa-solid fa-check-circle text-4xl mb-2"></i><p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤‡∏á</p></div>
                    </div>
                </div>

                <div class="col-span-1 space-y-6">
                    <div class="glass-card p-6 border-t-4 border-pink-500">
                        <h3 class="font-bold mb-4">‡πÄ‡∏ï‡∏¥‡∏°‡∏°‡∏∑‡∏≠ (Manual)</h3>
                        <div class="space-y-4">
                            <div><label class="text-xs text-slate-400 ml-1">UID / Email</label><input id="m-uid" class="input-adm" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..."></div>
                            <div><label class="text-xs text-slate-400 ml-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</label><input id="m-amt" type="number" class="input-adm" placeholder="0.00"></div>
                            <div class="grid grid-cols-2 gap-2">
                                <button onclick="Admin.manual('deposit')" class="bg-green-600 hover:bg-green-500 py-3 rounded-xl font-bold text-sm">‡πÄ‡∏ï‡∏¥‡∏° (+)</button>
                                <button onclick="Admin.manual('withdraw')" class="bg-red-600 hover:bg-red-500 py-3 rounded-xl font-bold text-sm">‡∏•‡∏ö (-)</button>
                            </div>
                        </div>
                    </div>
                    <div class="p-4 rounded-xl bg-blue-900/20 text-xs text-blue-200 border border-blue-500/20">
                        <h4 class="font-bold mb-2">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ñ‡∏≠‡∏ô:</h4>
                        <p>‡∏´‡∏≤‡∏Å‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ï‡∏¥‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ <span class="text-red-400 font-bold">LOCK</span> ‡∏à‡∏∞‡∏ñ‡∏≠‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏õ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤ "‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤" ‡∏Å‡πà‡∏≠‡∏ô</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="page-users" class="hidden animate__animated animate__fadeIn">
            <h1 class="text-3xl font-bold mb-8 font-display">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ & ‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡∏ü‡∏£‡∏µ</h1>
            <div class="glass-card overflow-hidden">
                <div class="p-4 border-b border-white/5"><input id="search-user" onkeyup="Admin.filterUsers()" class="input-adm pl-4 w-64" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠, ‡πÄ‡∏ö‡∏≠‡∏£‡πå, ‡πÑ‡∏≠‡∏î‡∏µ..."></div>
                <div class="overflow-x-auto">
                    <table class="w-full text-left">
                        <thead class="bg-white/5"><tr><th>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</th><th>‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£</th><th>‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï / ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th><th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead>
                        <tbody id="admin-user-list"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="page-rooms" class="hidden animate__animated animate__fadeIn">
            <div class="flex justify-between items-center mb-8">
                <h1 class="text-3xl font-bold font-display">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡∏°</h1>
                <button onclick="UI.modal('create-room', true)" class="btn-pink px-6 py-2 shadow-lg flex items-center gap-2"><i class="fa-solid fa-plus"></i> ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</button>
            </div>
            <div id="admin-room-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        </div>

        <div id="page-settings" class="hidden animate__animated animate__fadeIn">
            <h1 class="text-3xl font-bold mb-8 font-display">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå</h1>
            <div class="glass-card p-8 max-w-2xl">
                <div class="flex items-center justify-between p-4 bg-white/5 rounded-xl border border-white/5 mb-6">
                    <div><div class="font-bold text-lg">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå</div><div class="text-xs text-slate-400">‡∏õ‡∏¥‡∏î‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß (‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ)</div></div>
                    <label class="relative inline-flex items-center cursor-pointer"><input type="checkbox" id="set-status" class="sr-only peer"><div class="w-14 h-7 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[4px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-green-500"></div></label>
                </div>
                <div class="space-y-4">
                    <div><label class="text-xs text-slate-400 ml-1">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏ß‡πá‡∏ö (Title)</label><input id="set-name" class="input-adm"></div>
                    <div><label class="text-xs text-slate-400 ml-1">‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ß‡∏¥‡πà‡∏á (Marquee)</label><textarea id="set-annc" class="input-adm h-24 resize-none"></textarea></div>
                    <div><label class="text-xs text-slate-400 ml-1">‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ (Line/FB)</label><input id="set-fb" class="input-adm"></div>
                    <button onclick="Admin.saveSettings()" class="w-full btn-pink py-3 mt-4">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button>
                </div>
            </div>
        </div>

    </main>

    <div id="modal-create-room" class="modal-overlay">
        <div class="modal-box animate__animated animate__zoomIn">
            <h3 class="font-bold text-xl mb-6 text-white text-center">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô</h3>
            <div class="space-y-4">
                <input id="c-name" class="input-adm" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á">
                <input id="c-pass" class="input-adm" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (‡∏ß‡πà‡∏≤‡∏á‡πÑ‡∏ß‡πâ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏•‡πá‡∏≠‡∏Ñ)">
                <div class="grid grid-cols-2 gap-4">
                    <div><label class="text-xs ml-1 text-slate-400">‡πÄ‡∏Å‡∏°</label><select id="c-type" class="input-adm bg-[#1a0b2e]"><option value="xo">XO</option><option value="rps">‡πÄ‡∏õ‡πà‡∏≤‡∏¢‡∏¥‡πâ‡∏á‡∏â‡∏∏‡∏ö</option><option value="cup">‡∏¢‡∏¥‡∏á‡∏à‡∏∏‡∏î‡πÇ‡∏ó‡∏© (Cup)</option></select></div>
                    <div><label class="text-xs ml-1 text-slate-400">‡∏ä‡∏ô‡∏∞‡∏Å‡∏µ‡πà‡∏ï‡∏≤ (Win)</label><input id="c-win" type="number" class="input-adm" value="3"></div>
                </div>
                <div class="p-3 bg-white/5 rounded-xl border border-white/10 flex items-center gap-3">
                    <input type="checkbox" id="c-is-trial" class="w-5 h-5 accent-pink-500 cursor-pointer" onchange="document.getElementById('c-bet').disabled = this.checked; document.getElementById('c-bet').value = this.checked ? 0 : '';">
                    <label for="c-is-trial" class="text-sm font-bold text-pink-400 cursor-pointer">‡∏´‡πâ‡∏≠‡∏á‡∏ã‡πâ‡∏≠‡∏° (Demo / ‡πÑ‡∏°‡πà‡∏Å‡∏¥‡∏ô‡πÄ‡∏á‡∏¥‡∏ô)</label>
                </div>
                <input id="c-bet" type="number" class="input-adm" placeholder="‡∏¢‡∏≠‡∏î‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô (Credit)">
                <div class="flex gap-3 pt-4">
                    <button onclick="UI.modal('create-room', false)" class="flex-1 bg-slate-700 py-3 rounded-xl font-bold">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button onclick="Admin.createRoom()" class="flex-1 btn-pink py-3">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á</button>
                </div>
            </div>
        </div>
    </div>

    <div id="modal-edit-user" class="modal-overlay">
        <div class="modal-box animate__animated animate__zoomIn">
            <h3 class="font-bold text-xl mb-6 text-center text-white">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h3>
            <input type="hidden" id="e-uid">
            
            <div class="flex bg-slate-800 rounded-lg p-1 mb-4">
                <button onclick="Admin.switchEditTab('info')" id="tab-e-info" class="flex-1 py-2 rounded-md font-bold text-xs bg-pink-600 text-white transition">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</button>
                <button onclick="Admin.switchEditTab('bonus')" id="tab-e-bonus" class="flex-1 py-2 rounded-md font-bold text-xs text-slate-400 hover:text-white transition">‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡∏ü‡∏£‡∏µ & ‡∏•‡πá‡∏≠‡∏Ñ</button>
            </div>

            <div id="edit-tab-info" class="space-y-4">
                <div><label class="text-xs text-slate-400 ml-1">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô</label><input id="e-nick" class="input-adm"></div>
                <div><label class="text-xs text-slate-400 ml-1">‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï (Manual Edit)</label><input id="e-credit" type="number" class="input-adm font-mono text-yellow-400 font-bold text-xl"></div>
            </div>

            <div id="edit-tab-bonus" class="space-y-4 hidden">
                <div class="p-4 bg-yellow-500/10 border border-yellow-500/20 rounded-xl text-center">
                    <h4 class="font-bold text-yellow-400 mb-2">üéÅ ‡πÅ‡∏à‡∏Å‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡∏ü‡∏£‡∏µ</h4>
                    <p class="text-xs text-slate-400 mb-4">‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÅ‡∏à‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞ <span class="text-red-400">‡∏•‡πá‡∏≠‡∏Ñ‡∏Å‡∏≤‡∏£‡∏ñ‡∏≠‡∏ô</span> ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</p>
                    <div class="flex gap-2">
                        <input id="e-free-amt" type="number" class="input-adm text-center" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô">
                        <button onclick="Admin.giveFreeCredit()" class="bg-yellow-600 hover:bg-yellow-500 px-4 rounded-xl font-bold">‡πÅ‡∏à‡∏Å</button>
                    </div>
                </div>
                
                <div class="p-4 bg-red-500/10 border border-red-500/20 rounded-xl flex justify-between items-center">
                    <div>
                        <div class="font-bold text-red-400">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ñ‡∏≠‡∏ô</div>
                        <div class="text-xs text-slate-400" id="e-lock-status">...</div>
                    </div>
                    <button onclick="Admin.toggleLock()" id="btn-toggle-lock" class="bg-slate-700 px-4 py-2 rounded-lg text-xs font-bold">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô</button>
                </div>
            </div>

            <div class="flex gap-3 pt-6 mt-4 border-t border-white/5">
                <button onclick="UI.modal('edit-user', false)" class="flex-1 bg-slate-700 py-3 rounded-xl font-bold">‡∏õ‡∏¥‡∏î</button>
                <button onclick="Admin.saveUser()" class="flex-1 bg-green-600 py-3 rounded-xl font-bold hover:bg-green-500">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyAHAkBhypqyJuuL22tLrFKN7ZqdEsqGDTk", authDomain: "rsdm-9ca2a.firebaseapp.com", projectId: "rsdm-9ca2a", storageBucket: "rsdm-9ca2a.firebasestorage.app", messagingSenderId: "299212700124", appId: "1:299212700124:web:730160dae6bb1b09cbb719" };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth(); const db = firebase.firestore();
        let allUsers = [];

        const UI = {
            tab: (id) => { ['dash','rooms','users','trans','settings'].forEach(p => { document.getElementById(`page-${p}`).classList.add('hidden'); document.getElementById(`tab-${p}`).classList.remove('active'); }); document.getElementById(`page-${id}`).classList.remove('hidden'); document.getElementById(`tab-${id}`).classList.add('active'); },
            modal: (id, show) => document.getElementById(`modal-${id}`).style.display = show ? 'flex' : 'none',
            toast: (msg, type='success') => Swal.fire({ title: msg, icon: type, toast: true, position: 'top-end', showConfirmButton: false, timer: 2000, background: '#1a0b2e', color: '#fff' })
        };

        const Admin = {
            login: () => { auth.signInWithEmailAndPassword(document.getElementById('a-email').value, document.getElementById('a-pass').value).catch(err => Swal.fire('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', err.message, 'error')); },
            
            fixData: async () => {
                const conf = confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?');
                if(!conf) return;
                try {
                    await db.collection('config').doc('settings').set({isOpen: true, siteName: 'ZONE.', announcement: '‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà ZONE.', fbLink: '', maintenanceMsg: '‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏¥‡∏î‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á'}, {merge: true});
                    await db.collection('rooms').add({roomName: '‡∏´‡πâ‡∏≠‡∏á‡∏ã‡πâ‡∏≠‡∏°‡∏°‡∏∑‡∏≠ (Auto)', betAmount: 0, gameType: 'xo', players: [], maxWins: 1, createdAt: new Date()});
                    UI.toast('‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
                } catch(e) { Swal.fire('Error', e.message, 'error'); }
            },

            loadRequests: () => {
                db.collection('requests').onSnapshot(snap => {
                    const all = snap.docs.map(d => ({id:d.id, ...d.data()}));
                    const pending = all.filter(r => r.status === 'pending').sort((a,b) => (b.timestamp?.seconds||0)-(a.timestamp?.seconds||0));
                    document.getElementById('stat-pending').innerText = pending.length;
                    document.getElementById('noti-badge').classList.toggle('hidden', pending.length === 0);
                    const list = document.getElementById('request-list');
                    if(pending.length === 0) { list.innerHTML = ''; document.getElementById('empty-req').classList.remove('hidden'); return; }
                    document.getElementById('empty-req').classList.add('hidden');
                    list.innerHTML = pending.map(r => {
                        const isDep = r.type === 'deposit';
                        const color = isDep ? 'text-green-400' : 'text-red-400';
                        const badge = isDep ? 'bg-green-500/10 text-green-400 border border-green-500/20' : 'bg-red-500/10 text-red-400 border border-red-500/20';
                        const typeTxt = isDep ? '‡∏ù‡∏≤‡∏Å‡πÄ‡∏á‡∏¥‡∏ô' : '‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô';
                        return `<tr class="hover:bg-white/5 border-b border-white/5 transition">
                            <td class="p-4"><div>${r.nickname||'Guest'}</div><div class="text-xs text-slate-500 font-mono">${r.uid.slice(0,6)}...</div></td>
                            <td class="p-4"><span class="${badge} px-2 py-1 rounded text-xs font-bold">${typeTxt}</span></td>
                            <td class="p-4 font-mono font-bold ${color} text-lg">${r.amount.toLocaleString()}</td>
                            <td class="p-4 text-xs text-slate-400">${isDep ? `‡πÄ‡∏ß‡∏•‡∏≤: ${r.timeStr}` : `<button onclick="Admin.viewBank('${r.uid}')" class="text-pink-400 hover:underline"><i class="fa-solid fa-eye mr-1"></i>‡∏î‡∏π‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</button>`}</td>
                            <td class="p-4 text-center"><button onclick="Admin.process('${r.id}', 'approved', '${r.uid}', '${r.type}', ${r.amount})" class="bg-green-600 hover:bg-green-500 text-white w-8 h-8 rounded-lg shadow mr-2 transition"><i class="fa-solid fa-check"></i></button><button onclick="Admin.process('${r.id}', 'rejected', '${r.uid}', '${r.type}', ${r.amount})" class="bg-slate-700 hover:bg-red-600 text-white w-8 h-8 rounded-lg shadow transition"><i class="fa-solid fa-xmark"></i></button></td>
                        </tr>`;
                    }).join('');
                });
            },

            viewBank: async (uid) => {
                const doc = await db.collection('users').doc(uid).get();
                if(!doc.exists) return UI.toast('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'error');
                const u = doc.data();
                Swal.fire({ title: '‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤', html: `<div class="text-left bg-[#0f0518] p-4 rounded-xl border border-pink-500/30"><p>‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£: <strong class="text-pink-400">${u.bankName || '-'}</strong></p><p>‡πÄ‡∏•‡∏Ç: <strong class="text-xl text-yellow-400 select-all">${u.bankAcc || '-'}</strong></p><p>‡∏ä‡∏∑‡πà‡∏≠: <strong>${u.bankOwner || '-'}</strong></p></div>`, background: '#1a0b2e', color: '#fff' });
            },

            process: async (reqId, status, uid, type, amount) => {
                const batch = db.batch();
                const reqRef = db.collection('requests').doc(reqId);
                const userRef = db.collection('users').doc(uid);
                if(status === 'approved') {
                    if(type === 'deposit') batch.update(userRef, { credit: firebase.firestore.FieldValue.increment(amount) });
                    else {
                        const u = await userRef.get();
                        if(u.data().credit < amount) return Swal.fire('Error', '‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏û‡∏≠', 'error');
                        batch.update(userRef, { credit: firebase.firestore.FieldValue.increment(-amount) });
                    }
                    batch.set(db.collection('transactions').doc(), { uid, type, amount: (type=='deposit'?amount:-amount), status: 'approved', timestamp: new Date() });
                }
                batch.update(reqRef, { status: status });
                await batch.commit(); UI.toast('‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
            },

            manual: async (type) => {
                const input = document.getElementById('m-uid').value; const amt = parseFloat(document.getElementById('m-amt').value);
                if(!input || !amt) return UI.toast('‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö', 'warning');
                let uid = input;
                if(input.includes('@')) {
                    const s = await db.collection('users').where('email','==',input).get();
                    if(s.empty) return UI.toast('‡πÑ‡∏°‡πà‡∏û‡∏ö Email', 'error');
                    uid = s.docs[0].id;
                }
                const change = type === 'deposit' ? amt : -amt;
                await db.collection('users').doc(uid).update({ credit: firebase.firestore.FieldValue.increment(change) });
                await db.collection('transactions').add({ uid, type: 'manual_'+type, amount: change, timestamp: new Date() });
                UI.toast('‡∏õ‡∏£‡∏±‡∏ö‡∏¢‡∏≠‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
            },

            createRoom: () => {
                const n=document.getElementById('c-name').value, p=document.getElementById('c-pass').value, b=parseInt(document.getElementById('c-bet').value);
                const isTrial = document.getElementById('c-is-trial').checked;
                if(!n) return UI.toast('‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á', 'warning');
                db.collection('rooms').add({ roomName: n, password: p, gameType: document.getElementById('c-type').value, betAmount: isTrial?0:(b||0), maxWins: parseInt(document.getElementById('c-win').value), players: [], status: 'waiting', scores: {}, board: Array(9).fill(null), moves: {}, roundState: 'idle', createdAt: new Date() });
                UI.modal('create-room', false); UI.toast('‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß');
            },
            deleteRoom: (id) => Swal.fire({ title: '‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á?', icon: 'warning', showCancelButton: true, confirmButtonColor: '#d33', background: '#1a0b2e', color: '#fff' }).then(r => { if(r.isConfirmed) db.collection('rooms').doc(id).delete() }),

            filterUsers: () => { const t = document.getElementById('search-user').value.toLowerCase(); Admin.renderUsers(allUsers.filter(u => (u.nickname||'').toLowerCase().includes(t) || (u.email||'').toLowerCase().includes(t))); },
            renderUsers: (users) => {
                document.getElementById('admin-user-list').innerHTML = users.map(u => {
                    const isLocked = u.isFreeCredit;
                    const statusBadge = isLocked ? '<span class="lock-badge"><i class="fa-solid fa-lock"></i> LOCK</span>' : '<span class="text-green-400 text-xs font-bold">‡∏õ‡∏Å‡∏ï‡∏¥</span>';
                    return `<tr class="hover:bg-white/5 border-b border-white/5 transition"><td class="p-4 pl-6"><div class="font-bold text-white text-lg">${u.nickname}</div><div class="text-xs text-slate-500 font-mono select-all">${u.id}</div><div class="text-xs text-pink-400">${u.email}</div></td><td class="p-4 text-xs text-slate-300"><div>${u.bankName||'-'}</div><div class="font-mono select-all">${u.bankAcc||'-'}</div></td><td class="p-4 font-mono font-bold text-yellow-400 text-xl">${(u.credit||0).toLocaleString()} <br> ${statusBadge}</td><td class="p-4"><button onclick="Admin.openEdit('${u.id}')" class="bg-slate-700 hover:bg-slate-600 px-4 py-2 rounded-lg text-xs font-bold">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</button></td></tr>`;
                }).join('');
            },
            
            // --- EDIT USER & FREE CREDIT ---
            currentEditUser: null,
            openEdit: (id) => {
                Admin.currentEditUser = allUsers.find(u => u.id === id);
                const u = Admin.currentEditUser;
                document.getElementById('e-uid').value = id;
                document.getElementById('e-nick').value = u.nickname;
                document.getElementById('e-credit').value = u.credit;
                
                // Update Lock Status Text
                const lockTxt = document.getElementById('e-lock-status');
                const btnLock = document.getElementById('btn-toggle-lock');
                if(u.isFreeCredit) {
                    lockTxt.innerHTML = '<span class="text-red-400 font-bold">üîí ‡∏ï‡∏¥‡∏î‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç (‡∏ñ‡∏≠‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ)</span>';
                    btnLock.innerText = '‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ';
                    btnLock.className = 'bg-green-600 px-4 py-2 rounded-lg text-xs font-bold hover:bg-green-500';
                } else {
                    lockTxt.innerHTML = '<span class="text-green-400 font-bold">‚úî ‡∏õ‡∏Å‡∏ï‡∏¥ (‡∏ñ‡∏≠‡∏ô‡πÑ‡∏î‡πâ)</span>';
                    btnLock.innerText = '‡∏•‡πá‡∏≠‡∏Ñ';
                    btnLock.className = 'bg-red-600 px-4 py-2 rounded-lg text-xs font-bold hover:bg-red-500';
                }

                UI.modal('edit-user', true);
                Admin.switchEditTab('info');
            },
            switchEditTab: (tab) => {
                document.getElementById('edit-tab-info').classList.toggle('hidden', tab!=='info');
                document.getElementById('edit-tab-bonus').classList.toggle('hidden', tab!=='bonus');
                document.getElementById('tab-e-info').className = tab==='info' ? 'flex-1 py-2 rounded-md font-bold text-xs bg-pink-600 text-white transition' : 'flex-1 py-2 rounded-md font-bold text-xs text-slate-400 hover:text-white transition';
                document.getElementById('tab-e-bonus').className = tab==='bonus' ? 'flex-1 py-2 rounded-md font-bold text-xs bg-pink-600 text-white transition' : 'flex-1 py-2 rounded-md font-bold text-xs text-slate-400 hover:text-white transition';
            },
            giveFreeCredit: () => {
                const amt = parseFloat(document.getElementById('e-free-amt').value);
                const uid = document.getElementById('e-uid').value;
                if(!amt) return UI.toast('‡πÉ‡∏™‡πà‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô', 'warning');
                
                db.collection('users').doc(uid).update({
                    credit: firebase.firestore.FieldValue.increment(amt),
                    isFreeCredit: true // LOCK WITHDRAWAL
                }).then(() => {
                    db.collection('transactions').add({ uid, type: 'bonus_credit', amount: amt, note: 'Free Credit (Locked)', timestamp: new Date() });
                    UI.toast(`‡πÅ‡∏à‡∏Å ${amt} ‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï (‡∏•‡πá‡∏≠‡∏Ñ‡∏ñ‡∏≠‡∏ô)`);
                    UI.modal('edit-user', false);
                });
            },
            toggleLock: () => {
                const uid = document.getElementById('e-uid').value;
                const currentStatus = Admin.currentEditUser.isFreeCredit;
                db.collection('users').doc(uid).update({ isFreeCredit: !currentStatus }).then(() => {
                    UI.toast(currentStatus ? '‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ‡πÅ‡∏•‡πâ‡∏ß' : '‡∏•‡πá‡∏≠‡∏Ñ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏•‡πâ‡∏ß');
                    UI.modal('edit-user', false);
                });
            },
            saveUser: () => {
                const id=document.getElementById('e-uid').value, c=parseFloat(document.getElementById('e-credit').value), n=document.getElementById('e-nick').value;
                db.collection('users').doc(id).get().then(doc => {
                    const old = doc.data().credit;
                    db.collection('users').doc(id).update({ nickname: n, credit: c }).then(() => { 
                        if(old !== c) db.collection('transactions').add({ uid: id, type: 'admin_edit', amount: c-old, note: `Edit ${old}->${c}`, timestamp: new Date() });
                        UI.toast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß'); UI.modal('edit-user', false); 
                    });
                });
            },

            loadSettings: () => { db.collection('config').doc('settings').onSnapshot(d => { if(d.exists) { const v=d.data(); document.getElementById('set-status').checked=v.isOpen!==false; document.getElementById('set-name').value=v.siteName||''; document.getElementById('set-annc').value=v.announcement||''; document.getElementById('set-fb').value=v.fbLink||''; document.getElementById('set-msg').value=v.maintenanceMsg||''; } }); },
            saveSettings: () => { db.collection('config').doc('settings').set({ isOpen: document.getElementById('set-status').checked, siteName: document.getElementById('set-name').value, announcement: document.getElementById('set-annc').value, fbLink: document.getElementById('set-fb').value, maintenanceMsg: document.getElementById('set-msg').value }, { merge: true }); UI.toast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß'); }
        };

        auth.onAuthStateChanged(user => {
            if(user) {
                document.getElementById('view-login').style.display = 'none';
                document.getElementById('sidebar').classList.remove('hidden'); document.getElementById('sidebar').style.display = 'flex';
                document.getElementById('main-content').classList.remove('hidden');
                
                Admin.loadSettings(); Admin.loadRequests();

                db.collection('rooms').onSnapshot(s => { 
                    document.getElementById('stat-rooms').innerText = s.size;
                    const list = document.getElementById('admin-room-list');
                    if(s.empty) { list.innerHTML = '<div class="col-span-full py-10 text-center text-slate-500 border border-dashed border-pink-500/30 rounded-xl">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡πâ‡∏≠‡∏á (‡∏Å‡∏î‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô)</div>'; return; }
                    list.innerHTML = s.docs.map(d => { const r=d.data(); const isTrial = r.betAmount === 0; return `<div class="glass-card p-5 border-l-4 ${isTrial?'border-green-500':'border-pink-500'} flex justify-between items-center group hover:bg-white/5 relative overflow-hidden"><div class="relative z-10"><div class="font-bold text-lg text-white flex items-center gap-2">${r.roomName} ${isTrial ? '<span class="bg-green-500 text-[10px] px-2 rounded text-white">DEMO</span>' : ''}</div><div class="text-xs text-slate-400 font-mono mt-1 bg-slate-900/50 px-2 py-1 rounded inline-block"><span class="text-pink-400 font-bold">${r.gameType.toUpperCase()}</span> | Pass: ${r.password} | Bet: ${r.betAmount}</div></div><button onclick="Admin.deleteRoom('${d.id}')" class="bg-red-500/10 text-red-400 px-4 py-2 rounded-lg text-xs font-bold hover:bg-red-500 hover:text-white transition border border-red-500/20 z-10"><i class="fa-solid fa-trash"></i> ‡∏•‡∏ö</button></div>`; }).join('');
                });

                db.collection('users').onSnapshot(s => { document.getElementById('stat-users').innerText = s.size; allUsers=[]; s.forEach(d => allUsers.push({id:d.id, ...d.data()})); Admin.renderUsers(allUsers); });
                
                db.collection('transactions').onSnapshot(s => {
                    const docs = s.docs.map(d=>d.data()).sort((a,b)=>(b.timestamp?.seconds||0)-(a.timestamp?.seconds||0));
                    let dep=0, wit=0;
                    document.getElementById('live-trans').innerHTML = docs.slice(0,20).map(d => {
                        if(d.type.includes('deposit')) dep+=d.amount; if(d.type.includes('withdraw')) wit+=Math.abs(d.amount);
                        const color = d.amount > 0 ? 'text-green-400' : 'text-red-400';
                        return `<tr class="border-b border-white/5"><td class="p-4 font-mono text-xs text-slate-400">${d.uid.slice(0,6)}...</td><td class="p-4"><span class="bg-white/5 px-2 py-1 rounded text-xs font-bold text-slate-300 uppercase">${d.type}</span></td><td class="p-4 font-bold ${color}">${d.amount > 0 ? '+' : ''}${d.amount.toLocaleString()}</td><td class="p-4 text-right text-xs text-slate-500 font-mono">${d.timestamp?new Date(d.timestamp.toDate()).toLocaleTimeString():'-'}</td></tr>`;
                    }).join('');
                    document.getElementById('stat-dep').innerText = '+'+dep.toLocaleString(); document.getElementById('stat-wit').innerText = '-'+wit.toLocaleString();
                });
            } else { document.getElementById('view-login').style.display = 'flex'; }
        });
    </script>
</body>
</html>
