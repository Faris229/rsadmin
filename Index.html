<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADMIN CENTER | ZONE.</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@200;400;600;800&family=Prompt:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Prompt', 'sans-serif'], display: ['Outfit', 'sans-serif'] },
                    colors: { neon: { purple: '#d946ef', blue: '#4f46e5', cyan: '#06b6d4', red: '#f43f5e' } },
                    animation: { 'float': 'float 3s ease-in-out infinite' },
                    keyframes: { float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-5px)' } } }
                }
            }
        }
    </script>

    <style>
        body { background-color: #020617; color: #fff; overflow-x: hidden; }
        
        /* Background */
        .bg-grid {
            background-image: linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
            linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 40px 40px; position: fixed; inset: 0; z-index: -2;
        }
        .bg-glow {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at 0% 0%, rgba(79, 70, 229, 0.15), transparent 40%),
                        radial-gradient(circle at 100% 100%, rgba(217, 70, 239, 0.15), transparent 40%);
            z-index: -1;
        }

        /* Sidebar & Layout */
        .sidebar { width: 280px; height: 100vh; position: fixed; left: 0; top: 0; background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(20px); border-right: 1px solid rgba(255,255,255,0.05); z-index: 50; display: flex; flex-direction: column; }
        .main-content { margin-left: 280px; padding: 40px; min-height: 100vh; }
        
        /* Glass Card */
        .glass-card { background: rgba(30, 41, 59, 0.4); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.05); border-radius: 20px; transition: 0.3s; }
        .glass-card:hover { border-color: #4f46e5; box-shadow: 0 0 30px rgba(79, 70, 229, 0.1); }

        /* Inputs */
        .input-adm { width: 100%; background: rgba(0,0,0,0.3); border: 1px solid #334155; padding: 12px; border-radius: 10px; color: white; outline: none; transition: 0.3s; }
        .input-adm:focus { border-color: #d946ef; background: rgba(0,0,0,0.5); }

        /* Menu Items */
        .menu-item { display: flex; items-center; gap: 12px; padding: 16px; border-radius: 12px; color: #94a3b8; transition: 0.3s; cursor: pointer; margin-bottom: 8px; position: relative; }
        .menu-item:hover, .menu-item.active { background: linear-gradient(90deg, rgba(79,70,229,0.2), transparent); color: #fff; border-left: 4px solid #4f46e5; }
        .menu-item i { width: 24px; text-align: center; font-size: 1.2rem; }
        
        /* Notification Badge */
        .badge-count { position: absolute; right: 15px; background: #ef4444; color: white; font-size: 0.7rem; padding: 2px 8px; border-radius: 99px; font-weight: bold; }

        /* Table */
        table { width: 100%; text-align: left; border-collapse: collapse; }
        th { text-transform: uppercase; font-size: 0.75rem; color: #94a3b8; padding: 16px; font-weight: 700; letter-spacing: 1px; border-bottom: 1px solid rgba(255,255,255,0.05); }
        td { padding: 16px; border-bottom: 1px solid rgba(255,255,255,0.02); font-size: 0.9rem; }
        tr:hover { background: rgba(255,255,255,0.02); }

        /* Modal */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.9); backdrop-filter: blur(8px); z-index: 100; display: none; justify-content: center; align-items: center; }
        .modal-box { background: #0f172a; border: 1px solid #334155; width: 100%; max-width: 550px; border-radius: 24px; padding: 30px; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5); position: relative; animation: zoomIn 0.3s; }
    </style>
</head>
<body class="flex min-h-screen">

    <div class="bg-grid"></div>
    <div class="bg-glow"></div>

    <div id="view-login" class="fixed inset-0 z-[200] bg-[#020617] flex items-center justify-center p-6">
        <div class="w-full max-w-sm text-center">
            <div class="mb-8 relative inline-block">
                <div class="absolute inset-0 bg-purple-600 blur-3xl opacity-30 animate-pulse"></div>
                <h1 class="text-5xl font-black font-display tracking-tighter text-white relative z-10">ADMIN OP</h1>
            </div>
            <div class="space-y-4 glass-card p-8 rounded-3xl">
                <input id="a-email" value="faris@gmail.com" class="input-adm text-center" placeholder="Email">
                <input id="a-pass" type="password" class="input-adm text-center" placeholder="Password">
                <button onclick="Admin.login()" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 py-3 rounded-xl font-bold hover:shadow-lg hover:shadow-blue-500/30 transition">ACCESS SYSTEM</button>
            </div>
        </div>
    </div>

    <aside class="sidebar p-6">
        <div class="mb-10 flex items-center gap-3 px-2">
            <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center shadow-lg"><i class="fa-solid fa-shield-halved text-white"></i></div>
            <div>
                <div class="font-bold text-xl font-display tracking-wider">COMMAND</div>
                <div class="text-[10px] text-emerald-400 tracking-widest font-bold">● ONLINE</div>
            </div>
        </div>
        
        <nav class="flex-1">
            <div onclick="UI.tab('dash')" id="tab-dash" class="menu-item active"><i class="fa-solid fa-chart-pie text-blue-400"></i> แดชบอร์ด</div>
            
            <div onclick="UI.tab('requests')" id="tab-requests" class="menu-item">
                <i class="fa-solid fa-bell text-yellow-400"></i> คำขอฝาก/ถอน
                <span id="badge-req" class="badge-count hidden">0</span>
            </div>

            <div onclick="UI.tab('rooms')" id="tab-rooms" class="menu-item"><i class="fa-solid fa-gamepad text-purple-400"></i> จัดการห้อง</div>
            <div onclick="UI.tab('users')" id="tab-users" class="menu-item"><i class="fa-solid fa-users text-pink-400"></i> ผู้เล่น</div>
            <div onclick="UI.tab('settings')" id="tab-settings" class="menu-item"><i class="fa-solid fa-sliders text-orange-400"></i> ตั้งค่าเว็บ</div>
        </nav>

        <button onclick="auth.signOut()" class="bg-white/5 hover:bg-red-500/20 text-red-400 py-3 rounded-xl font-bold transition flex items-center justify-center gap-2">
            <i class="fa-solid fa-power-off"></i> LOGOUT
        </button>
    </aside>

    <div class="main-content flex-1">
        
        <div id="page-dash" class="animate__animated animate__fadeIn">
            <header class="mb-8">
                <h1 class="text-3xl font-bold font-display">DASHBOARD</h1>
                <p class="text-slate-400">ภาพรวมสถานะของระบบ</p>
            </header>
            <div class="grid grid-cols-4 gap-6 mb-10">
                <div class="glass-card p-6 relative overflow-hidden">
                    <div class="text-xs text-slate-400 font-bold uppercase tracking-widest mb-2">Total Users</div>
                    <div id="stat-users" class="text-4xl font-bold text-white">0</div>
                    <i class="fa-solid fa-users absolute bottom-4 right-4 text-4xl opacity-10"></i>
                </div>
                <div class="glass-card p-6 relative overflow-hidden border-l-4 border-l-yellow-500">
                    <div class="text-xs text-slate-400 font-bold uppercase tracking-widest mb-2">Pending Req</div>
                    <div id="stat-req" class="text-4xl font-bold text-yellow-400">0</div>
                    <i class="fa-solid fa-bell absolute bottom-4 right-4 text-4xl opacity-10"></i>
                </div>
                <div class="glass-card p-6 relative overflow-hidden border-l-4 border-l-purple-500">
                    <div class="text-xs text-slate-400 font-bold uppercase tracking-widest mb-2">Active Rooms</div>
                    <div id="stat-rooms" class="text-4xl font-bold text-purple-400">0</div>
                    <i class="fa-solid fa-gamepad absolute bottom-4 right-4 text-4xl opacity-10"></i>
                </div>
            </div>
        </div>

        <div id="page-requests" class="hidden animate__animated animate__fadeIn">
            <div class="flex justify-between items-center mb-8">
                <h1 class="text-3xl font-bold font-display">REQUESTS <span class="text-sm bg-yellow-500/20 text-yellow-400 px-2 py-1 rounded ml-2">Pending</span></h1>
                <button onclick="Admin.loadRequests()" class="text-slate-400 hover:text-white"><i class="fa-solid fa-rotate"></i> Refresh</button>
            </div>
            
            <div class="glass-card p-0 overflow-hidden">
                <table class="w-full">
                    <thead><tr><th>User</th><th>Type</th><th>Amount</th><th>Time/Slip</th><th>Action</th></tr></thead>
                    <tbody id="request-list">
                        <tr><td colspan="5" class="p-8 text-center text-slate-500">ไม่มีรายการรอตรวจสอบ</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div id="page-rooms" class="hidden animate__animated animate__fadeIn">
            <div class="flex justify-between items-center mb-8">
                <h1 class="text-3xl font-bold font-display">ROOMS</h1>
                <button onclick="UI.modal('create-room', true)" class="bg-blue-600 hover:bg-blue-500 px-6 py-3 rounded-xl font-bold shadow-lg flex items-center gap-2"><i class="fa-solid fa-plus"></i> สร้างห้องใหม่</button>
            </div>
            <div id="admin-room-list" class="grid grid-cols-2 gap-6"></div>
        </div>

        <div id="page-users" class="hidden animate__animated animate__fadeIn">
            <h1 class="text-3xl font-bold font-display mb-8">USERS</h1>
            <div class="glass-card p-0 overflow-hidden">
                <div class="p-4 border-b border-white/5">
                    <input id="search-user" onkeyup="Admin.filterUsers()" class="input-adm w-64" placeholder="ค้นหาชื่อ / Email...">
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead><tr><th>Profile</th><th>Bank Info</th><th>Credit</th><th>Action</th></tr></thead>
                        <tbody id="admin-user-list"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="page-settings" class="hidden animate__animated animate__fadeIn">
            <h1 class="text-3xl font-bold font-display mb-8">SETTINGS</h1>
            <div class="glass-card p-8 max-w-2xl space-y-6">
                <div class="flex items-center justify-between p-4 bg-white/5 rounded-xl border border-white/5">
                    <div>
                        <div class="font-bold text-lg">สถานะเว็บไซต์</div>
                        <div class="text-xs text-slate-400">เปิด/ปิด โหมดปรับปรุงระบบ (ลูกค้าจะเข้าไม่ได้)</div>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="set-status" class="sr-only peer">
                        <div class="w-14 h-7 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[4px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-green-500"></div>
                    </label>
                </div>
                <div><label class="text-xs text-slate-400 font-bold ml-1">Site Name</label><input id="set-name" class="input-adm" placeholder="ชื่อเว็บ"></div>
                <div><label class="text-xs text-slate-400 font-bold ml-1">Announcement</label><textarea id="set-annc" class="input-adm h-24 resize-none" placeholder="ประกาศหน้าเว็บ..."></textarea></div>
                <div><label class="text-xs text-slate-400 font-bold ml-1">Facebook Link</label><input id="set-fb" class="input-adm" placeholder="https://m.me/..."></div>
                <div><label class="text-xs text-slate-400 font-bold ml-1">Maintenance Message</label><input id="set-msg" class="input-adm" placeholder="ข้อความแจ้งเตือนตอนปิดเว็บ"></div>
                <button onclick="Admin.saveSettings()" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:shadow-lg py-3 rounded-xl font-bold transition">บันทึกการตั้งค่า</button>
            </div>
        </div>

    </div>

    <div id="modal-create-room" class="modal-overlay">
        <div class="modal-box">
            <h3 class="font-bold text-xl mb-6 text-white">สร้างห้องใหม่</h3>
            <div class="space-y-4">
                <input id="c-name" class="input-adm" placeholder="ชื่อห้อง">
                <input id="c-pass" class="input-adm" placeholder="รหัสผ่านห้อง">
                <div class="grid grid-cols-2 gap-4">
                    <select id="c-type" class="input-adm bg-[#0f172a]"><option value="xo">XO</option><option value="rps">เป่ายิ้งฉุบ</option><option value="cup">ซ่อนบอล</option></select>
                    <input id="c-win" type="number" class="input-adm" value="3" placeholder="Best of">
                </div>
                <input id="c-bet" type="number" class="input-adm" placeholder="ยอดเดิมพัน (Credit)">
                <div class="flex gap-3 pt-4">
                    <button onclick="UI.modal('create-room', false)" class="flex-1 bg-slate-700 py-3 rounded-xl font-bold hover:bg-slate-600">ยกเลิก</button>
                    <button onclick="Admin.createRoom()" class="flex-1 bg-blue-600 py-3 rounded-xl font-bold hover:bg-blue-500">สร้างทันที</button>
                </div>
            </div>
        </div>
    </div>

    <div id="modal-edit-user" class="modal-overlay">
        <div class="modal-box">
            <h3 class="font-bold text-xl mb-6">แก้ไขข้อมูลผู้ใช้</h3>
            <input type="hidden" id="e-uid">
            <div class="space-y-4">
                <div><label class="text-xs text-slate-400 font-bold ml-1">Nickname</label><input id="e-nick" class="input-adm"></div>
                <div><label class="text-xs text-slate-400 font-bold ml-1">Credit (แก้โดยตรง)</label><input id="e-credit" type="number" class="input-adm font-mono text-yellow-400 font-bold"></div>
                <div class="flex gap-3 pt-4">
                    <button onclick="UI.modal('edit-user', false)" class="flex-1 bg-slate-700 py-3 rounded-xl font-bold">ยกเลิก</button>
                    <button onclick="Admin.saveUser()" class="flex-1 bg-green-600 py-3 rounded-xl font-bold hover:bg-green-500">บันทึก & สร้าง Log</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // CONFIG
        const firebaseConfig = { apiKey: "AIzaSyAHAkBhypqyJuuL22tLrFKN7ZqdEsqGDTk", authDomain: "rsdm-9ca2a.firebaseapp.com", projectId: "rsdm-9ca2a", storageBucket: "rsdm-9ca2a.firebasestorage.app", messagingSenderId: "299212700124", appId: "1:299212700124:web:730160dae6bb1b09cbb719" };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth(); const db = firebase.firestore();

        let allUsers = [];

        // UI
        const UI = {
            tab: (id) => {
                ['dash','rooms','users','trans','settings','requests'].forEach(p => {
                    document.getElementById(`page-${p}`)?.classList.add('hidden');
                    document.getElementById(`tab-${p}`)?.classList.remove('active');
                });
                document.getElementById(`page-${id}`).classList.remove('hidden');
                document.getElementById(`tab-${id}`).classList.add('active');
            },
            modal: (id, show) => document.getElementById(`modal-${id}`).style.display = show ? 'flex' : 'none',
            toast: (msg) => Swal.fire({ title: msg, icon: 'success', toast: true, position: 'top-end', showConfirmButton: false, timer: 2000, background: '#1e293b', color: '#fff' })
        };

        const Admin = {
            login: () => {
                const e = document.getElementById('a-email').value, p = document.getElementById('a-pass').value;
                auth.signInWithEmailAndPassword(e,p).catch(err => alert(err.message));
            },
            
            // --- NEW: REQUEST MANAGEMENT ---
            loadRequests: () => { /* Handled by snapshot listener below */ },
            
            processRequest: (reqId, action, reqData) => {
                // action: 'approved' or 'rejected'
                const { uid, amount, type } = reqData;
                
                Swal.fire({
                    title: `ยืนยัน ${action === 'approved' ? 'อนุมัติ' : 'ปฏิเสธ'}?`,
                    text: `${type} : ${amount}`,
                    icon: 'question',
                    showCancelButton: true,
                    confirmButtonText: 'ยืนยัน',
                    background: '#1e293b', color: '#fff'
                }).then(async (res) => {
                    if(res.isConfirmed) {
                        const batch = db.batch();
                        const reqRef = db.collection('requests').doc(reqId);
                        batch.update(reqRef, { status: action }); // Update request status

                        if(action === 'approved') {
                            const userRef = db.collection('users').doc(uid);
                            // If deposit -> Add Credit
                            if(type === 'deposit') {
                                batch.update(userRef, { credit: firebase.firestore.FieldValue.increment(amount) });
                            } 
                            // If withdraw -> Credit already checked/deducted (or deduct here if prefer)
                            // In this simple version, assume withdraw deducts upon approval:
                            if(type === 'withdraw') {
                                batch.update(userRef, { credit: firebase.firestore.FieldValue.increment(-amount) });
                            }

                            // Add Transaction Log
                            const transRef = db.collection('transactions').doc();
                            batch.set(transRef, {
                                uid: uid,
                                type: type,
                                amount: amount,
                                timestamp: new Date(),
                                note: `Admin Approved`
                            });
                        }

                        await batch.commit();
                        UI.toast('ดำเนินการเรียบร้อย');
                    }
                });
            },

            // ROOMS
            createRoom: () => {
                const n = document.getElementById('c-name').value, p = document.getElementById('c-pass').value, t = document.getElementById('c-type').value;
                const b = parseInt(document.getElementById('c-bet').value), w = parseInt(document.getElementById('c-win').value);
                if(!n||!b) return alert('กรอกชื่อและเดิมพัน');
                db.collection('rooms').add({
                    roomName: n, password: p, gameType: t, betAmount: b, maxWins: w,
                    players: [], status: 'waiting', scores: {}, createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                UI.modal('create-room', false); UI.toast('สร้างห้องสำเร็จ');
            },
            deleteRoom: (id) => {
                if(confirm('ลบห้องนี้?')) db.collection('rooms').doc(id).delete();
            },

            // USERS
            filterUsers: () => {
                const txt = document.getElementById('search-user').value.toLowerCase();
                const filtered = allUsers.filter(u => u.nickname.toLowerCase().includes(txt) || u.email.toLowerCase().includes(txt));
                Admin.renderUsers(filtered);
            },
            renderUsers: (users) => {
                const list = document.getElementById('admin-user-list');
                list.innerHTML = users.map(u => `
                    <tr class="hover:bg-white/5 transition border-t border-white/5">
                        <td class="p-4 pl-6"><div class="font-bold text-white">${u.nickname}</div><div class="text-xs text-slate-500 font-mono">${u.id}</div></td>
                        <td class="p-4 text-xs text-slate-300"><div class="font-bold text-purple-400">${u.bankName || '-'}</div><div>${u.bankAcc || '-'}</div></td>
                        <td class="p-4 font-mono font-bold text-yellow-400 text-lg">${u.credit.toLocaleString()}</td>
                        <td class="p-4"><button onclick="Admin.openEdit('${u.id}', '${u.nickname}', ${u.credit})" class="bg-slate-700 hover:bg-slate-600 px-3 py-1 rounded-lg text-xs font-bold">EDIT</button></td>
                    </tr>
                `).join('');
            },
            openEdit: (id, nick, cred) => {
                document.getElementById('e-uid').value = id; document.getElementById('e-nick').value = nick; document.getElementById('e-credit').value = cred;
                UI.modal('edit-user', true);
            },
            saveUser: () => {
                const id = document.getElementById('e-uid').value, n = document.getElementById('e-nick').value, c = parseFloat(document.getElementById('e-credit').value);
                db.collection('users').doc(id).update({ nickname: n, credit: c }).then(() => { UI.toast('บันทึกแล้ว'); UI.modal('edit-user', false); });
            },

            // SETTINGS
            saveSettings: () => {
                db.collection('config').doc('settings').set({
                    isOpen: document.getElementById('set-status').checked,
                    siteName: document.getElementById('set-name').value,
                    announcement: document.getElementById('set-annc').value,
                    fbLink: document.getElementById('set-fb').value,
                    maintenanceMsg: document.getElementById('set-msg').value
                }, { merge: true });
                UI.toast('บันทึกแล้ว');
            }
        };

        // INIT
        auth.onAuthStateChanged(user => {
            if(user && user.email === 'faris@gmail.com') {
                document.getElementById('view-login').style.display = 'none';
                
                // Settings Loader
                db.collection('config').doc('settings').get().then(d => { if(d.exists) { const c=d.data(); document.getElementById('set-status').checked=c.isOpen!==false; document.getElementById('set-name').value=c.siteName||''; document.getElementById('set-annc').value=c.announcement||''; document.getElementById('set-fb').value=c.fbLink||''; document.getElementById('set-msg').value=c.maintenanceMsg||''; } });

                // Requests Listener
                db.collection('requests').orderBy('timestamp', 'desc').onSnapshot(snap => {
                    const pending = snap.docs.filter(d => d.data().status === 'pending');
                    const badge = document.getElementById('badge-req');
                    const statReq = document.getElementById('stat-req');
                    
                    if(pending.length > 0) {
                        badge.classList.remove('hidden');
                        badge.innerText = pending.length;
                        statReq.innerText = pending.length;
                    } else {
                        badge.classList.add('hidden');
                        statReq.innerText = 0;
                    }

                    const list = document.getElementById('request-list');
                    if(snap.empty) { list.innerHTML = '<tr><td colspan="5" class="p-8 text-center text-slate-500">ไม่มีรายการ</td></tr>'; return; }
                    
                    list.innerHTML = snap.docs.map(doc => {
                        const r = doc.data();
                        const statusColor = r.status==='approved'?'text-green-400':(r.status==='rejected'?'text-red-400':'text-yellow-400');
                        const statusText = r.status==='approved'?'อนุมัติแล้ว':(r.status==='rejected'?'ปฏิเสธ':'รอตรวจสอบ');
                        
                        // Action Buttons only for Pending
                        let actions = '';
                        if(r.status === 'pending') {
                            // Fix passing object to function in HTML string
                            const dataStr = JSON.stringify({uid:r.uid, amount:r.amount, type:r.type}).replace(/"/g, '&quot;');
                            actions = `
                                <button onclick="Admin.processRequest('${doc.id}', 'approved', ${dataStr})" class="bg-green-600 px-3 py-1 rounded text-xs mr-2 hover:bg-green-500">อนุมัติ</button>
                                <button onclick="Admin.processRequest('${doc.id}', 'rejected', ${dataStr})" class="bg-red-600 px-3 py-1 rounded text-xs hover:bg-red-500">ปฏิเสธ</button>
                            `;
                        } else {
                            actions = `<span class="text-xs text-slate-500">ดำเนินการแล้ว</span>`;
                        }

                        return `<tr class="border-b border-slate-700 hover:bg-white/5">
                            <td class="p-4"><div class="font-bold">${r.nickname}</div><div class="text-xs text-slate-500">${r.uid}</div></td>
                            <td><span class="${r.type=='deposit'?'text-green-400':'text-red-400'} font-bold uppercase text-xs border border-white/10 px-2 py-1 rounded">${r.type}</span></td>
                            <td class="font-mono text-lg font-bold">${r.amount.toLocaleString()}</td>
                            <td class="text-xs text-slate-400"><div>${r.timeStr}</div><div>${r.timestamp?.toDate().toLocaleString('th-TH')}</div></td>
                            <td>
                                <div class="mb-1 font-bold text-xs ${statusColor}">${statusText}</div>
                                <div>${actions}</div>
                            </td>
                        </tr>`;
                    }).join('');
                });

                // Other Listeners (Users, Rooms)
                db.collection('users').onSnapshot(s => { document.getElementById('stat-users').innerText = s.size; allUsers = []; s.forEach(d => allUsers.push({id: d.id, ...d.data()})); Admin.renderUsers(allUsers); });
                db.collection('rooms').onSnapshot(s => { 
                    document.getElementById('stat-rooms').innerText = s.size; 
                    document.getElementById('admin-room-list').innerHTML = s.docs.map(d=>`<div class="glass-card p-4 flex justify-between items-center"><div><div class="font-bold">${d.data().roomName}</div><div class="text-xs text-slate-400">${d.data().gameType} | Bet: ${d.data().betAmount}</div></div><button onclick="Admin.deleteRoom('${d.id}')" class="text-red-400 hover:text-white"><i class="fa-solid fa-trash"></i></button></div>`).join('');
                });

            } else { document.getElementById('view-login').style.display = 'flex'; }
        });
    </script>
</body>
</html>
