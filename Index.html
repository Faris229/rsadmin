<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADMIN CONSOLE | Ultimate Control</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@200;400;600;800&family=Prompt:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Prompt', 'sans-serif'], display: ['Outfit', 'sans-serif'] },
                    colors: {
                        brand: {
                            dark: '#020617',
                            card: '#0f172a',
                            accent: '#6366f1',
                            success: '#10b981',
                            warning: '#f59e0b',
                            danger: '#ef4444'
                        }
                    },
                    animation: { 'pulse-slow': 'pulse 3s infinite' }
                }
            }
        }
    </script>

    <style>
        body { background-color: #020617; color: #cbd5e1; overflow-x: hidden; }
        
        /* Glassmorphism */
        .glass-panel {
            background: rgba(15, 23, 42, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .glass-card {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.4), rgba(15, 23, 42, 0.6));
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .glass-card:hover {
            border-color: #6366f1;
            transform: translateY(-3px);
            box-shadow: 0 10px 30px -10px rgba(99, 102, 241, 0.2);
        }

        /* Sidebar */
        .sidebar {
            width: 280px; height: 100vh; position: fixed; left: 0; top: 0;
            background: #0b1121; border-right: 1px solid #1e293b;
            z-index: 50; display: flex; flex-direction: column;
        }
        
        .menu-item {
            display: flex; items-center; gap: 12px; padding: 14px 20px;
            border-radius: 12px; color: #94a3b8; transition: 0.3s;
            cursor: pointer; margin-bottom: 5px; font-weight: 500;
        }
        .menu-item:hover, .menu-item.active {
            background: rgba(99, 102, 241, 0.1);
            color: #fff;
            border-left: 4px solid #6366f1;
        }
        .menu-item i { width: 24px; text-align: center; }

        /* Content Area */
        .main-content { margin-left: 280px; padding: 40px; min-height: 100vh; }
        
        /* Custom Inputs */
        .input-admin {
            width: 100%; background: #1e293b; border: 1px solid #334155;
            padding: 10px 14px; border-radius: 10px; color: white; outline: none; transition: 0.3s;
        }
        .input-admin:focus { border-color: #6366f1; background: #0f172a; }

        /* Tables */
        table { width: 100%; text-align: left; border-collapse: separate; border-spacing: 0; }
        th { 
            text-transform: uppercase; font-size: 0.75rem; color: #64748b; 
            padding: 16px; font-weight: 700; letter-spacing: 1px; 
            border-bottom: 1px solid #1e293b; 
        }
        td { padding: 16px; border-bottom: 1px solid #1e293b; vertical-align: middle; }
        tr:last-child td { border-bottom: none; }
        tr:hover td { background: rgba(255,255,255,0.02); }

        /* Status Badges */
        .badge { padding: 4px 10px; border-radius: 99px; font-size: 0.7rem; font-weight: bold; text-transform: uppercase; }
        .badge-pending { background: rgba(245, 158, 11, 0.2); color: #f59e0b; border: 1px solid rgba(245, 158, 11, 0.3); }
        .badge-approved { background: rgba(16, 185, 129, 0.2); color: #10b981; border: 1px solid rgba(16, 185, 129, 0.3); }
        .badge-rejected { background: rgba(239, 68, 68, 0.2); color: #ef4444; border: 1px solid rgba(239, 68, 68, 0.3); }

        /* Toggle Switch */
        .toggle-checkbox:checked { right: 0; border-color: #68D391; }
        .toggle-checkbox:checked + .toggle-label { background-color: #68D391; }
    </style>
</head>
<body class="font-sans antialiased">

    <div id="login-overlay" class="fixed inset-0 z-[100] bg-[#020617] flex items-center justify-center p-4">
        <div class="w-full max-w-sm text-center animate__animated animate__fadeIn">
            <div class="inline-flex items-center justify-center w-20 h-20 bg-indigo-500/10 rounded-full mb-6 border border-indigo-500/20 shadow-[0_0_30px_rgba(99,102,241,0.3)]">
                <i class="fa-solid fa-shield-cat text-4xl text-indigo-500"></i>
            </div>
            <h1 class="text-3xl font-black font-display text-white mb-2 tracking-tight">ADMIN CONSOLE</h1>
            <p class="text-slate-500 mb-8 text-sm">Restricted Access Only</p>
            
            <div class="glass-card p-8 space-y-4 text-left">
                <div>
                    <label class="text-xs font-bold text-slate-400 uppercase ml-1">Email</label>
                    <input id="login-email" class="input-admin mt-1" placeholder="admin@zone.com">
                </div>
                <div>
                    <label class="text-xs font-bold text-slate-400 uppercase ml-1">Password</label>
                    <input id="login-pass" type="password" class="input-admin mt-1" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                <button onclick="Admin.login()" class="w-full py-3 bg-indigo-600 hover:bg-indigo-500 text-white rounded-xl font-bold shadow-lg shadow-indigo-900/50 transition transform hover:scale-[1.02]">
                    <i class="fa-solid fa-lock-open mr-2"></i> LOGIN
                </button>
            </div>
        </div>
    </div>

    <div id="admin-interface" class="hidden flex">
        
        <aside class="sidebar p-6">
            <div class="flex items-center gap-3 mb-10 px-2">
                <div class="w-10 h-10 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-lg flex items-center justify-center font-bold text-white shadow-lg">Z</div>
                <div>
                    <div class="font-bold text-lg leading-none font-display">ZONE.</div>
                    <div class="text-[10px] text-slate-500 font-bold tracking-widest">ADMINISTRATOR</div>
                </div>
            </div>

            <nav class="flex-1 space-y-1">
                <div onclick="UI.switchTab('dash')" id="nav-dash" class="menu-item active">
                    <i class="fa-solid fa-chart-pie"></i> ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î
                </div>
                <div onclick="UI.switchTab('requests')" id="nav-requests" class="menu-item justify-between">
                    <div class="flex items-center gap-3"><i class="fa-solid fa-money-bill-transfer"></i> ‡∏ù‡∏≤‡∏Å/‡∏ñ‡∏≠‡∏ô</div>
                    <span id="badge-count" class="bg-red-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-full hidden">0</span>
                </div>
                <div onclick="UI.switchTab('rooms')" id="nav-rooms" class="menu-item">
                    <i class="fa-solid fa-gamepad"></i> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡∏°
                </div>
                <div onclick="UI.switchTab('users')" id="nav-users" class="menu-item">
                    <i class="fa-solid fa-users"></i> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô
                </div>
                <div onclick="UI.switchTab('settings')" id="nav-settings" class="menu-item">
                    <i class="fa-solid fa-sliders"></i> ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö
                </div>
            </nav>

            <div class="pt-6 border-t border-slate-800">
                <button onclick="auth.signOut()" class="w-full py-3 bg-white/5 hover:bg-red-500/10 text-slate-400 hover:text-red-400 rounded-xl font-bold transition flex items-center justify-center gap-2">
                    <i class="fa-solid fa-power-off"></i> ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
                </button>
            </div>
        </aside>

        <main class="main-content w-full">
            
            <div id="tab-dash" class="animate__animated animate__fadeIn">
                <h2 class="text-3xl font-bold mb-6 font-display">‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="glass-card p-6">
                        <div class="text-xs text-slate-400 font-bold uppercase tracking-widest mb-2">Total Users</div>
                        <div class="flex justify-between items-end">
                            <div class="text-4xl font-bold text-white" id="st-users">0</div>
                            <div class="w-10 h-10 bg-indigo-500/20 rounded-lg flex items-center justify-center text-indigo-400"><i class="fa-solid fa-users"></i></div>
                        </div>
                    </div>
                    <div class="glass-card p-6 border-l-4 border-l-purple-500">
                        <div class="text-xs text-slate-400 font-bold uppercase tracking-widest mb-2">Active Rooms</div>
                        <div class="flex justify-between items-end">
                            <div class="text-4xl font-bold text-purple-400" id="st-rooms">0</div>
                            <div class="w-10 h-10 bg-purple-500/20 rounded-lg flex items-center justify-center text-purple-400"><i class="fa-solid fa-gamepad"></i></div>
                        </div>
                    </div>
                    <div class="glass-card p-6 border-l-4 border-l-yellow-500">
                        <div class="text-xs text-slate-400 font-bold uppercase tracking-widest mb-2">Pending Req</div>
                        <div class="flex justify-between items-end">
                            <div class="text-4xl font-bold text-yellow-400" id="st-pending">0</div>
                            <div class="w-10 h-10 bg-yellow-500/20 rounded-lg flex items-center justify-center text-yellow-400"><i class="fa-regular fa-clock"></i></div>
                        </div>
                    </div>
                    <div class="glass-card p-6 border-l-4 border-l-green-500">
                        <div class="text-xs text-slate-400 font-bold uppercase tracking-widest mb-2">System Status</div>
                        <div class="flex justify-between items-end">
                            <div class="text-2xl font-bold text-green-400" id="st-system">ONLINE</div>
                            <div class="w-10 h-10 bg-green-500/20 rounded-lg flex items-center justify-center text-green-400"><i class="fa-solid fa-server"></i></div>
                        </div>
                    </div>
                </div>

                <div class="glass-card p-0 overflow-hidden">
                    <div class="p-6 border-b border-white/5 flex justify-between items-center">
                        <h3 class="font-bold text-lg text-white">‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (Live Feed)</h3>
                        <span class="flex items-center gap-2 text-xs text-green-400"><span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span> Real-time</span>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead><tr><th>User ID</th><th>Type</th><th>Amount</th><th class="text-right">Time</th></tr></thead>
                            <tbody id="dash-trans-list">
                                <tr><td colspan="4" class="p-8 text-center text-slate-500">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="tab-requests" class="hidden animate__animated animate__fadeIn">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold font-display">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ù‡∏≤‡∏Å-‡∏ñ‡∏≠‡∏ô</h2>
                    <div class="flex gap-2">
                        <button onclick="Admin.loadRequests('pending')" class="px-4 py-2 bg-yellow-500/20 text-yellow-400 rounded-lg text-sm font-bold border border-yellow-500/30">‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</button>
                        <button onclick="Admin.loadRequests('all')" class="px-4 py-2 bg-slate-800 text-slate-400 rounded-lg text-sm font-bold border border-slate-700">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                    </div>
                </div>
                
                <div class="glass-card p-0 overflow-hidden min-h-[500px]">
                    <table class="w-full">
                        <thead class="bg-slate-900/50">
                            <tr>
                                <th class="w-1/4">‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô / ID</th>
                                <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                                <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</th>
                                <th>‡πÄ‡∏ß‡∏•‡∏≤ / ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
                                <th class="text-right">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                            </tr>
                        </thead>
                        <tbody id="request-list-body"></tbody>
                    </table>
                </div>
            </div>

            <div id="tab-rooms" class="hidden animate__animated animate__fadeIn">
                <div class="flex justify-between items-end mb-8">
                    <div>
                        <h2 class="text-3xl font-bold font-display text-white">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡∏°</h2>
                        <p class="text-slate-400 mt-1">‡∏î‡∏π‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏î ‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</p>
                    </div>
                    <button onclick="UI.toggleModal('create-room', true)" class="bg-indigo-600 hover:bg-indigo-500 text-white px-6 py-3 rounded-xl font-bold shadow-lg shadow-indigo-500/30 flex items-center gap-2 transition hover:-translate-y-1">
                        <i class="fa-solid fa-plus-circle"></i> ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà
                    </button>
                </div>

                <div id="room-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    </div>
            </div>

            <div id="tab-users" class="hidden animate__animated animate__fadeIn">
                <h2 class="text-3xl font-bold font-display mb-6">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</h2>
                
                <div class="glass-card p-6 mb-6">
                    <div class="flex gap-4">
                        <div class="relative flex-1">
                            <i class="fa-solid fa-search absolute top-1/2 -translate-y-1/2 left-4 text-slate-500"></i>
                            <input id="user-search" onkeyup="Admin.filterUsers()" class="input-admin pl-10" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢ ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô, ‡∏≠‡∏µ‡πÄ‡∏°‡∏• ‡∏´‡∏£‡∏∑‡∏≠ UID...">
                        </div>
                    </div>
                </div>

                <div class="glass-card p-0 overflow-hidden">
                    <table class="w-full">
                        <thead class="bg-slate-900/50">
                            <tr>
                                <th>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</th>
                                <th>‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£</th>
                                <th>‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th>
                                <th class="text-right">Action</th>
                            </tr>
                        </thead>
                        <tbody id="user-list-body"></tbody>
                    </table>
                </div>
            </div>

            <div id="tab-settings" class="hidden animate__animated animate__fadeIn">
                <h2 class="text-3xl font-bold font-display mb-8">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</h2>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="glass-card p-8 space-y-6">
                        <h3 class="text-xl font-bold text-white border-b border-white/10 pb-4 mb-4">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</h3>
                        
                        <div>
                            <label class="text-xs font-bold text-slate-400 uppercase ml-1">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå (Site Name)</label>
                            <input id="set-name" class="input-admin mt-1" placeholder="ZONE.">
                        </div>
                        
                        <div>
                            <label class="text-xs font-bold text-slate-400 uppercase ml-1">‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ï‡∏±‡∏ß‡∏ß‡∏¥‡πà‡∏á (Marquee)</label>
                            <textarea id="set-annc" class="input-admin mt-1 h-24 resize-none" placeholder="‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®..."></textarea>
                        </div>
                        
                        <div>
                            <label class="text-xs font-bold text-slate-400 uppercase ml-1">‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ (Facebook/Line)</label>
                            <input id="set-link" class="input-admin mt-1" placeholder="https://...">
                        </div>
                    </div>

                    <div class="glass-card p-8 space-y-6 border-l-4 border-l-red-500">
                        <h3 class="text-xl font-bold text-white border-b border-white/10 pb-4 mb-4">‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏£‡∏∞‡∏ö‡∏ö (Danger Zone)</h3>
                        
                        <div class="flex items-center justify-between bg-slate-900/50 p-4 rounded-xl border border-white/5">
                            <div>
                                <div class="font-bold text-white">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå</div>
                                <div class="text-xs text-slate-400">‡∏õ‡∏¥‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏£‡∏∞‡∏ö‡∏ö (‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ)</div>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="set-status" class="sr-only peer">
                                <div class="w-14 h-7 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[4px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-green-500"></div>
                            </label>
                        </div>

                        <div>
                            <label class="text-xs font-bold text-slate-400 uppercase ml-1">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏¥‡∏î‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á</label>
                            <input id="set-msg" class="input-admin mt-1" placeholder="‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏¥‡∏î‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß...">
                        </div>

                        <div class="pt-4">
                            <button onclick="Admin.saveSettings()" class="w-full py-4 bg-indigo-600 hover:bg-indigo-500 rounded-xl font-bold text-white shadow-lg transition">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <div id="modal-create-room" class="modal-overlay fixed inset-0 z-50 bg-black/80 backdrop-blur-sm hidden flex items-center justify-center p-4">
        <div class="modal-box glass-card w-full max-w-md p-8 animate__animated animate__zoomIn">
            <h3 class="text-2xl font-bold mb-6 text-white">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà</h3>
            <div class="space-y-4">
                <input id="c-name" class="input-admin" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á (‡πÄ‡∏ä‡πà‡∏ô ‡∏´‡πâ‡∏≠‡∏á‡∏ß‡∏±‡∏î‡πÉ‡∏à 1)">
                <input id="c-pass" class="input-admin" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏´‡πâ‡∏≠‡∏á (‡∏ß‡πà‡∏≤‡∏á = ‡πÑ‡∏°‡πà‡∏•‡πá‡∏≠‡∏Ñ)">
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-xs text-slate-400 font-bold ml-1">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏Å‡∏°</label>
                        <select id="c-type" class="input-admin bg-[#1e293b]">
                            <option value="cup">ü•§ ‡∏ã‡πà‡∏≠‡∏ô‡∏•‡∏π‡∏Å‡∏ö‡∏≠‡∏•</option>
                            <option value="xo">‚ùå‚≠ï ‡πÄ‡∏≠‡πá‡∏Å‡∏ã‡πå‡πÇ‡∏≠</option>
                            <option value="rps">‚úä‚úåÔ∏è‚úã ‡πÄ‡∏õ‡πà‡∏≤‡∏¢‡∏¥‡∏á‡∏â‡∏∏‡∏ö</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-xs text-slate-400 font-bold ml-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡∏ô‡∏∞ (Best of)</label>
                        <input id="c-win" type="number" class="input-admin" value="1">
                    </div>
                </div>
                
                <div>
                    <label class="text-xs text-slate-400 font-bold ml-1">‡∏¢‡∏≠‡∏î‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô (Credit)</label>
                    <input id="c-bet" type="number" class="input-admin text-yellow-400 font-bold" placeholder="0 = ‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏î‡∏•‡∏≠‡∏á">
                    <p class="text-[10px] text-slate-500 mt-1">*‡πÉ‡∏™‡πà 0 ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏î‡∏•‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô‡∏ü‡∏£‡∏µ</p>
                </div>

                <div class="flex gap-3 pt-4">
                    <button onclick="UI.toggleModal('create-room', false)" class="flex-1 py-3 bg-slate-700 hover:bg-slate-600 rounded-xl font-bold text-slate-300">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button onclick="Admin.createRoom()" class="flex-1 py-3 bg-indigo-600 hover:bg-indigo-500 rounded-xl font-bold text-white shadow-lg">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</button>
                </div>
            </div>
        </div>
    </div>

    <div id="modal-edit-user" class="modal-overlay fixed inset-0 z-50 bg-black/80 backdrop-blur-sm hidden flex items-center justify-center p-4">
        <div class="modal-box glass-card w-full max-w-md p-8 animate__animated animate__zoomIn">
            <h3 class="text-2xl font-bold mb-6 text-white">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</h3>
            <input type="hidden" id="e-uid">
            <div class="space-y-4">
                <div>
                    <label class="text-xs text-slate-400 font-bold ml-1">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô</label>
                    <input id="e-nick" class="input-admin">
                </div>
                <div>
                    <label class="text-xs text-slate-400 font-bold ml-1">‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á)</label>
                    <input id="e-credit" type="number" class="input-admin text-yellow-400 font-bold font-mono">
                </div>
                
                <div class="bg-slate-800 p-3 rounded-xl flex items-center justify-between border border-slate-700">
                    <span class="text-sm">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡∏ü‡∏£‡∏µ (Lock ‡∏ñ‡∏≠‡∏ô)</span>
                    <input type="checkbox" id="e-free" class="w-5 h-5 accent-red-500">
                </div>

                <div class="flex gap-3 pt-4">
                    <button onclick="UI.toggleModal('edit-user', false)" class="flex-1 py-3 bg-slate-700 hover:bg-slate-600 rounded-xl font-bold text-slate-300">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button onclick="Admin.saveUser()" class="flex-1 py-3 bg-green-600 hover:bg-green-500 rounded-xl font-bold text-white shadow-lg">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // CONFIG
        const firebaseConfig = { apiKey: "AIzaSyAHAkBhypqyJuuL22tLrFKN7ZqdEsqGDTk", authDomain: "rsdm-9ca2a.firebaseapp.com", projectId: "rsdm-9ca2a", storageBucket: "rsdm-9ca2a.firebasestorage.app", messagingSenderId: "299212700124", appId: "1:299212700124:web:730160dae6bb1b09cbb719" };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let allUsers = [];

        // UI Helpers
        const UI = {
            switchTab: (id) => {
                ['dash','requests','rooms','users','settings'].forEach(p => {
                    document.getElementById(`tab-${p}`).classList.add('hidden');
                    document.getElementById(`nav-${p}`).classList.remove('active');
                });
                document.getElementById(`tab-${id}`).classList.remove('hidden');
                document.getElementById(`nav-${id}`).classList.add('active');
            },
            toggleModal: (id, show) => {
                const el = document.getElementById(`modal-${id}`);
                if(show) { el.classList.remove('hidden'); el.style.display = 'flex'; }
                else { el.classList.add('hidden'); el.style.display = 'none'; }
            },
            toast: (msg, icon='success') => Swal.fire({ title: msg, icon: icon, toast: true, position: 'top-end', showConfirmButton: false, timer: 2000, background: '#1e293b', color: '#fff' })
        };

        // ADMIN LOGIC
        const Admin = {
            login: () => {
                const e = document.getElementById('login-email').value;
                const p = document.getElementById('login-pass').value;
                auth.signInWithEmailAndPassword(e, p).catch(err => UI.toast(err.message, 'error'));
            },
            
            init: () => {
                // 1. Dashboard & Transactions
                db.collection('transactions').orderBy('timestamp', 'desc').limit(10).onSnapshot(snap => {
                    const list = document.getElementById('dash-trans-list');
                    if(snap.empty) { list.innerHTML = '<tr><td colspan="4" class="p-6 text-center text-slate-500">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</td></tr>'; return; }
                    list.innerHTML = snap.docs.map(doc => {
                        const d = doc.data();
                        const color = d.amount > 0 ? 'text-green-400' : 'text-red-400';
                        return `<tr class="border-b border-slate-800 hover:bg-slate-800/50">
                            <td class="p-4"><span class="font-mono text-xs text-slate-500">${d.uid.slice(0,6)}...</span></td>
                            <td class="p-4 text-xs font-bold uppercase">${d.type}</td>
                            <td class="p-4 font-mono font-bold ${color}">${d.amount > 0 ? '+' : ''}${d.amount}</td>
                            <td class="p-4 text-right text-xs text-slate-500">${d.timestamp?.toDate().toLocaleTimeString()}</td>
                        </tr>`;
                    }).join('');
                });

                // 2. Requests
                db.collection('requests').orderBy('timestamp', 'desc').onSnapshot(snap => {
                    const pending = snap.docs.filter(d => d.data().status === 'pending');
                    document.getElementById('badge-count').innerText = pending.length;
                    document.getElementById('badge-count').classList.toggle('hidden', pending.length === 0);
                    document.getElementById('st-pending').innerText = pending.length;
                    
                    const list = document.getElementById('request-list-body');
                    list.innerHTML = snap.docs.map(doc => {
                        const r = doc.data();
                        const statusColor = r.status==='approved'?'text-green-400':(r.status==='rejected'?'text-red-400':'text-yellow-400');
                        
                        // Action Buttons Logic
                        let actions = '';
                        if(r.status === 'pending') {
                            const dataStr = JSON.stringify({uid:r.uid, amount:r.amount, type:r.type}).replace(/"/g, '&quot;');
                            actions = `
                                <button onclick="Admin.processReq('${doc.id}', 'approved', ${dataStr})" class="bg-green-500/20 text-green-400 hover:bg-green-500 hover:text-white px-3 py-1 rounded text-xs font-bold transition mr-2">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
                                <button onclick="Admin.processReq('${doc.id}', 'rejected', ${dataStr})" class="bg-red-500/20 text-red-400 hover:bg-red-500 hover:text-white px-3 py-1 rounded text-xs font-bold transition">‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</button>
                            `;
                        } else {
                            actions = `<span class="text-xs text-slate-500">‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß</span>`;
                        }

                        return `<tr class="border-b border-slate-800 hover:bg-slate-800/50">
                            <td class="p-4">
                                <div class="font-bold text-white">${r.nickname}</div>
                                <div class="text-xs text-slate-500">${r.uid}</div>
                            </td>
                            <td class="p-4"><span class="text-xs font-bold uppercase ${r.type=='deposit'?'text-green-400':'text-red-400'} bg-white/5 px-2 py-1 rounded border border-white/5">${r.type}</span></td>
                            <td class="p-4 font-mono font-bold text-lg">${r.amount.toLocaleString()}</td>
                            <td class="p-4 text-xs text-slate-400">
                                <div class="text-white">${r.timeStr}</div>
                                <div>${r.timestamp?.toDate().toLocaleString('th-TH')}</div>
                            </td>
                            <td class="p-4 text-right">
                                <div class="mb-1 text-xs font-bold ${statusColor}">${r.status.toUpperCase()}</div>
                                <div>${actions}</div>
                            </td>
                        </tr>`;
                    }).join('');
                });

                // 3. Rooms
                db.collection('rooms').onSnapshot(snap => {
                    document.getElementById('st-rooms').innerText = snap.size;
                    const list = document.getElementById('room-grid');
                    if(snap.empty) { list.innerHTML = '<div class="col-span-full text-center text-slate-500 py-10">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏´‡πâ‡∏≠‡∏á</div>'; return; }
                    
                    list.innerHTML = snap.docs.map(doc => {
                        const r = doc.data();
                        const isLive = r.players.length === 2;
                        const betDisplay = r.betAmount === 0 ? '<span class="text-green-400">‡∏ó‡∏î‡∏•‡∏≠‡∏á</span>' : r.betAmount;
                        
                        // Live Score
                        const p1 = r.players[0] || '?'; const p2 = r.players[1] || '?';
                        const s1 = r.scores[p1] || 0; const s2 = r.scores[p2] || 0;

                        return `
                        <div class="glass-card p-5 relative overflow-hidden group">
                            <div class="flex justify-between items-start mb-3">
                                <div>
                                    <div class="text-lg font-bold text-white">${r.roomName}</div>
                                    <div class="text-xs text-slate-400 font-mono mt-1">
                                        <span class="bg-indigo-500/20 text-indigo-300 px-2 rounded">${r.gameType.toUpperCase()}</span>
                                        Pass: ${r.password || '-'}
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="font-mono font-bold text-xl text-yellow-400">${betDisplay}</div>
                                    <div class="text-[10px] ${isLive?'text-red-400 animate-pulse':'text-slate-500'} font-bold mt-1">‚óè ${isLive ? 'LIVE' : 'WAITING'}</div>
                                </div>
                            </div>
                            
                            <div class="bg-slate-900/50 rounded-lg p-2 flex justify-between items-center text-xs mb-3">
                                <div class="${isLive?'text-cyan-400':'text-slate-500'}">P1: ${s1}</div>
                                <div class="text-slate-600">VS</div>
                                <div class="${isLive?'text-pink-400':'text-slate-500'}">P2: ${s2}</div>
                            </div>

                            <button onclick="Admin.deleteRoom('${doc.id}')" class="w-full py-2 bg-red-500/10 text-red-400 hover:bg-red-500 hover:text-white rounded-lg text-xs font-bold transition">
                                <i class="fa-solid fa-trash mr-1"></i> ‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á
                            </button>
                        </div>`;
                    }).join('');
                });

                // 4. Users
                db.collection('users').onSnapshot(snap => {
                    document.getElementById('st-users').innerText = snap.size;
                    allUsers = []; snap.forEach(doc => allUsers.push({id: doc.id, ...doc.data()}));
                    Admin.renderUsers(allUsers);
                });

                // 5. Config
                db.collection('config').doc('settings').get().then(d => {
                    if(d.exists) {
                        const c = d.data();
                        document.getElementById('set-status').checked = c.isOpen !== false;
                        document.getElementById('set-name').value = c.siteName || '';
                        document.getElementById('set-annc').value = c.announcement || '';
                        document.getElementById('set-link').value = c.fbLink || '';
                        document.getElementById('set-msg').value = c.maintenanceMsg || '';
                    }
                });
            },

            // --- FUNCTIONS ---
            
            // Requests
            processReq: async (reqId, action, data) => {
                const { uid, amount, type } = data;
                
                Swal.fire({
                    title: action === 'approved' ? '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£?' : '‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£?',
                    text: `${type.toUpperCase()} : ${amount} ‡∏ö‡∏≤‡∏ó`,
                    icon: 'question',
                    showCancelButton: true,
                    confirmButtonColor: action === 'approved' ? '#10b981' : '#ef4444',
                    background: '#1e293b', color: '#fff'
                }).then(async (res) => {
                    if(res.isConfirmed) {
                        const batch = db.batch();
                        const reqRef = db.collection('requests').doc(reqId);
                        batch.update(reqRef, { status: action });

                        if(action === 'approved') {
                            const userRef = db.collection('users').doc(uid);
                            const change = type === 'deposit' ? amount : -amount;
                            batch.update(userRef, { credit: firebase.firestore.FieldValue.increment(change) });

                            // Log Transaction
                            const transRef = db.collection('transactions').doc();
                            batch.set(transRef, {
                                uid: uid, type: type, amount: change, timestamp: new Date(),
                                note: `Approved via Admin Panel`
                            });
                        }
                        
                        await batch.commit();
                        UI.toast('‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
                    }
                });
            },

            // Rooms
            createRoom: () => {
                const n = document.getElementById('c-name').value;
                const p = document.getElementById('c-pass').value;
                const t = document.getElementById('c-type').value;
                const b = parseInt(document.getElementById('c-bet').value);
                const w = parseInt(document.getElementById('c-win').value);
                
                if(!n) return UI.toast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á', 'warning');

                db.collection('rooms').add({
                    roomName: n, password: p, gameType: t, betAmount: b, maxWins: w,
                    players: [], status: 'waiting', scores: {}, createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    roundState: 'idle'
                });
                UI.toggleModal('create-room', false);
                UI.toast('‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
            },
            deleteRoom: (id) => {
                Swal.fire({ title: '‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ?', icon: 'warning', showCancelButton: true, confirmButtonColor: '#d33', background: '#1e293b', color:'#fff' }).then(r => {
                    if(r.isConfirmed) db.collection('rooms').doc(id).delete();
                });
            },

            // Users
            filterUsers: () => {
                const txt = document.getElementById('user-search').value.toLowerCase();
                const filtered = allUsers.filter(u => u.nickname.toLowerCase().includes(txt) || u.email.toLowerCase().includes(txt));
                Admin.renderUsers(filtered);
            },
            renderUsers: (users) => {
                const list = document.getElementById('user-list-body');
                list.innerHTML = users.map(u => `
                    <tr class="border-b border-slate-800 hover:bg-slate-800/50 transition">
                        <td class="p-4">
                            <div class="font-bold text-white">${u.nickname} ${u.isFreeCredit ? '<span class="bg-red-500 text-white text-[10px] px-1 rounded ml-1">‡∏ï‡∏¥‡∏î‡∏ü‡∏£‡∏µ</span>' : ''}</div>
                            <div class="text-xs text-slate-500 font-mono">${u.id}</div>
                            <div class="text-xs text-slate-600">${u.email}</div>
                        </td>
                        <td class="p-4 text-xs text-slate-400">
                            <div class="font-bold text-indigo-400">${u.bankName || '-'}</div>
                            <div>${u.bankAcc || '-'}</div>
                        </td>
                        <td class="p-4 font-mono font-bold text-yellow-400 text-lg">${u.credit.toLocaleString()}</td>
                        <td class="p-4 text-right">
                            <button onclick="Admin.openEdit('${u.id}', '${u.nickname}', ${u.credit}, ${u.isFreeCredit||false})" class="bg-slate-700 hover:bg-slate-600 px-3 py-1 rounded-lg text-xs font-bold transition">EDIT</button>
                        </td>
                    </tr>
                `).join('');
            },
            openEdit: (id, nick, cred, isFree) => {
                document.getElementById('e-uid').value = id;
                document.getElementById('e-nick').value = nick;
                document.getElementById('e-credit').value = cred;
                document.getElementById('e-free').checked = isFree;
                UI.toggleModal('edit-user', true);
            },
            saveUser: () => {
                const id = document.getElementById('e-uid').value;
                const n = document.getElementById('e-nick').value;
                const c = parseFloat(document.getElementById('e-credit').value);
                const f = document.getElementById('e-free').checked;

                db.collection('users').doc(id).get().then(doc => {
                    const old = doc.data().credit;
                    db.collection('users').doc(id).update({ nickname: n, credit: c, isFreeCredit: f });
                    
                    if(old !== c) {
                        const diff = c - old;
                        db.collection('transactions').add({ uid: id, type: 'admin_adj', amount: diff, note: `Admin Edited (${old}->${c})`, timestamp: new Date() });
                    }
                    UI.toast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß');
                    UI.toggleModal('edit-user', false);
                });
            },

            // Settings
            saveSettings: () => {
                db.collection('config').doc('settings').set({
                    isOpen: document.getElementById('set-status').checked,
                    siteName: document.getElementById('set-name').value,
                    announcement: document.getElementById('set-annc').value,
                    fbLink: document.getElementById('set-link').value,
                    maintenanceMsg: document.getElementById('set-msg').value
                }, { merge: true });
                UI.toast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡πâ‡∏ß');
            }
        };

        // Init
        auth.onAuthStateChanged(user => {
            if(user && user.email === 'faris@gmail.com') {
                document.getElementById('login-overlay').classList.add('hidden');
                Admin.init();
            } else {
                document.getElementById('login-overlay').classList.remove('hidden');
            }
        });
    </script>
</body>
</html>
